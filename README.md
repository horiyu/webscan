# WEB Scan [WIP]

Web カメラを使用してラインスキャニング機能を実現する Flask アプリケーションです。固定ラインを通過する画素を時間方向に積層してスキャン画像を生成できます。

## 機能

- **リアルタイムラインスキャニング**: Web カメラからの映像で指定したラインの画素を連続的に積層
- **カラー・グレースケール対応**: RGB 積層とグレースケール積層の切り替え可能
- **スキャン方向選択**: 縦ライン（横方向積層）・横ライン（縦方向積層）の選択
- **画像調整機能**: 回転（0°/90°/180°/270°）、縮小率の設定
- **保存機能**: PNG・PDF 形式での保存に対応
- **リアルタイムプレビュー**: 積層結果をリアルタイムで確認

## 必要なライブラリ

```bash
pip install flask opencv-python pillow numpy img2pdf
```

## 使い方

### 1. アプリケーションの起動

```bash
python webscan.py
```

ブラウザで `http://127.0.0.1:5000` にアクセスしてください。

### 2. 基本操作

1. **カメラ権限の許可**: 初回アクセス時に Web カメラの使用許可を与えてください
2. **スキャン設定の調整**:

   - **モード**: 縦ライン（横積層）または横ライン（縦積層）を選択
   - **ライン位置**: スライダーでスキャンラインの位置を調整（0.0-1.0）
   - **太さ px**: スキャンラインの太さを設定（1-50 ピクセル）
   - **縮小**: 出力画像の縮小倍率を設定（1-8 倍）
   - **回転**: 入力画像の回転角度を選択
   - **カラー出力**: チェックでカラー、未チェックでグレースケール
   - **送信 FPS**: フレーム送信レートを設定（1-60FPS）

3. **スキャン実行**:

   - **Start**: ラインスキャニング開始
   - **Stop**: スキャニング停止
   - **Reset**: 積層画像をクリア

4. **保存**:
   - **PNG 保存**: 積層結果を PNG 形式で保存
   - **PDF 保存**: 積層結果を PDF 形式で保存（A4 サイズ）

### 3. 使用例

#### ドキュメントスキャン

- **モード**: 縦ライン
- **ライン位置**: 0.5（中央）
- **太さ**: 3-5 ピクセル
- **カラー**: 必要に応じて選択
- 紙を左から右（または右から左）にゆっくり移動

#### 物体の表面スキャン

- **モード**: 横ライン
- **ライン位置**: 適切な位置に調整
- **カラー**: ON 推奨
- 物体を上下に移動またはカメラを移動

## 技術仕様

### アーキテクチャ

- **フロントエンド**: HTML5 + JavaScript（Canvas API 使用）
- **バックエンド**: Flask + OpenCV + NumPy
- **画像処理**: リアルタイムフレーム処理とストライプ抽出

### 処理フロー

1. Web カメラからフレーム取得
2. 指定位置のストライプを抽出・平均化
3. 設定に応じて縮小処理
4. キャンバスに積層（水平または垂直連結）
5. プレビュー表示・保存処理

### API エンドポイント

- `GET /`: メインページ
- `POST /start`: スキャン開始・設定更新
- `POST /stop`: スキャン停止
- `POST /reset`: キャンバスリセット
- `POST /stream`: フレームデータ送信
- `GET /image`: プレビュー画像取得
- `POST /save_png`: PNG 保存
- `POST /save_pdf`: PDF 保存

## ファイル構成

```
linecamera-webapp/
├── webscan.py          # メインアプリケーション
├── README.md           # このファイル
└── .gitignore          # Git除外設定
```

## 注意事項

- **カメラ権限**: ブラウザで Web カメラの使用許可が必要です
- **照明条件**: 均一な拡散光での使用を推奨します
- **移動速度**: スキャン対象はゆっくりと均等な速度で移動してください
- **ブラウザ対応**: モダンブラウザ（Chrome, Firefox, Safari 等）が必要です
- **パフォーマンス**: 高解像度・高 FPS での使用時は CPU 使用率が高くなる場合があります

## トラブルシューティング

### カメラが認識されない

- ブラウザの設定でカメラ権限を確認
- 他のアプリケーションがカメラを使用していないか確認
- HTTPS または localhost でのアクセスを確認

### スキャン画像が乱れる

- 移動速度を一定に保つ
- 照明条件を改善（影や反射を避ける）
- ライン位置と太さを調整

### 保存ができない

- ブラウザのダウンロード設定を確認
- 十分なディスク容量があることを確認
